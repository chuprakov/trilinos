<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4: http://docutils.sourceforge.net/" />
<title>Testing</title>
<style type="text/css">

/*
:Author: David Goodger
:Contact: goodger@users.sourceforge.net
:Date: $Date: 2005-12-18 01:56:14 +0100 (Sun, 18 Dec 2005) $
:Revision: $Revision: 4224 $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin-left: 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em ;
  background-color: #eeeeee }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

tt.docutils {
  background-color: #eeeeee }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="testing">
<h1 class="title">Testing</h1>
<p>There are two directories in the PyTrilinos package that provide
python scripts for testing PyTrilinos, <tt class="docutils literal"><span class="pre">example</span></tt> and <tt class="docutils literal"><span class="pre">test</span></tt>.
Generally speaking, unit tests go in the <tt class="docutils literal"><span class="pre">test</span></tt> directory and
descriptive or demonstrative example scripts go in <tt class="docutils literal"><span class="pre">example</span></tt>.</p>
<div class="section">
<h1><a id="naming-conventions" name="naming-conventions">Naming Conventions</a></h1>
<p>Unit tests scripts shall begin with <tt class="docutils literal"><span class="pre">test</span></tt>, followed by the package
name and an underscore, followed by a short description of the test,
typically the class name being tested.  For example:</p>
<pre class="literal-block">
testTeuchos_ParameterList
testEpetra_MultiVector
</pre>
<p>are the base names of the unit tests for <tt class="docutils literal"><span class="pre">Teuchos.ParameterList</span></tt> and
<tt class="docutils literal"><span class="pre">Epetra.MultiVector</span></tt>, respectively.  In certain situations, the
underscore and test description can be omitted.</p>
<p>Example scripts shall begin with <tt class="docutils literal"><span class="pre">ex</span></tt>, followed by the name of the
primary package being demonstrated, followed by an underscore and a
short description of the test.  For example:</p>
<pre class="literal-block">
exEpetra_Comm
exAztecOO_Operator
</pre>
<p>are the base names for example scripts demonstrating the Epetra.Comm
class and an AztecOO solver that uses an Epetra.Operator,
respectively.  In certain situations, the underscore and test
description can be omitted.</p>
</div>
<div class="section">
<h1><a id="build-system" name="build-system">Build System</a></h1>
<p>Running <tt class="docutils literal"><span class="pre">make</span></tt> in either the top, <tt class="docutils literal"><span class="pre">example</span></tt> or <tt class="docutils literal"><span class="pre">test</span></tt> build
directories simply copies the test scripts from the source directory
to the build directory.  For historical reasons, the source files have
the suffix <tt class="docutils literal"><span class="pre">.src</span></tt> and the build files have the suffix <tt class="docutils literal"><span class="pre">.py</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">CMakeLists.txt</span></tt> files in the <tt class="docutils literal"><span class="pre">test</span></tt> and <tt class="docutils literal"><span class="pre">example</span></tt>
directories control which scripts get copied to the build directory.
Each test script, or group of related test scripts, should be
protected with <tt class="docutils literal"><span class="pre">IF()</span></tt> statements, depending on which PyTrilinos
modules need to be present for the script to run.</p>
</div>
<div class="section">
<h1><a id="running-all-tests" name="running-all-tests">Running All Tests</a></h1>
<p>To run all of the enabled tests, first make sure PyTrilinos and all
tests and examples are up-to-date:</p>
<pre class="literal-block">
$ cd BUILD/packages/PyTrilinos
$ make
</pre>
<p>Then you can use the CMake <tt class="docutils literal"><span class="pre">ctest</span></tt> program to run all of the tests:</p>
<pre class="literal-block">
$ ctest -W 10
</pre>
<p>The results of all of the tests can be found in the <tt class="docutils literal"><span class="pre">Testing</span></tt>
directory, present in the directory from which <tt class="docutils literal"><span class="pre">ctest</span></tt> was run.</p>
</div>
<div class="section">
<h1><a id="test-script-conventions" name="test-script-conventions">Test Script Conventions</a></h1>
<p>All test scripts shall use the <tt class="docutils literal"><span class="pre">optparse</span></tt> module to parse command
line options and support the following options:</p>
<pre class="literal-block">
-t, --testharness     test local build modules; prevent loading
                      system-installed modules
-v VERBOSITY, --verbosity=VERBOSITY
                      set the verbosity level [default 2]
</pre>
<p>The <tt class="docutils literal"><span class="pre">-t</span></tt> option is to force use of the locally-built PyTrilinos,
preventing the importing of any installed PyTrilinos modules.  The
verbosity option is used in all <tt class="docutils literal"><span class="pre">test</span></tt> scripts and optionally in any
<tt class="docutils literal"><span class="pre">example</span></tt> scripts where it makes sense.</p>
<p>Tests scripts use the <tt class="docutils literal"><span class="pre">from</span> <span class="pre">PyTrilinosImport</span></tt> function in the
<tt class="docutils literal"><span class="pre">testutil</span></tt> module, local to both <tt class="docutils literal"><span class="pre">test</span></tt> and <tt class="docutils literal"><span class="pre">example</span></tt>
directories, to control where the PyTrilinos modules are imported
from.  The user controls this import location from the command line:
<tt class="docutils literal"><span class="pre">-t</span></tt> or <tt class="docutils literal"><span class="pre">--testharness</span></tt> indicates that the build directory should
be used; otherwise an import from standard locations will be
attempted.</p>
<p>This policy is enabled by code in each test/example script like the
following:</p>
<pre class="literal-block">
parser = OptionParser()
parser.add_option(&quot;-t&quot;, &quot;--testharness&quot;, action=&quot;store_true&quot;,
                  dest=&quot;testharness&quot;, default=False,
                  help=&quot;test local build modules; prevent loading system-installed modules&quot;)
options,args = parser.parse_args()
from testutil import fromPyTrilinosImport
Teuchos = fromPyTrilinosImport('Teuchos', options.testharness)
Epetra  = fromPyTrilinosImport('Epetra' , options.testharness)
</pre>
<p>If the user specifies <tt class="docutils literal"><span class="pre">-t</span></tt> or <tt class="docutils literal"><span class="pre">--testharness</span></tt> then
<tt class="docutils literal"><span class="pre">options.testharness</span></tt> will be True, else it will be False.  When
<tt class="docutils literal"><span class="pre">fromPyTrilinosImport()</span></tt> is called, the <tt class="docutils literal"><span class="pre">options.testharness</span></tt>
argument will determine where the import is read from.</p>
<p>Test scripts shall run in both serial or parallel.  You may use
either:</p>
<pre class="literal-block">
comm = Teuchos.DefaultComm.getComm()
</pre>
<p>or:</p>
<pre class="literal-block">
comm = Epetra.PyComm()
</pre>
<p>to obtain an appropriate communicator object for the test scripts.  By
convention, set the variable <tt class="docutils literal"><span class="pre">iAmRoot</span></tt> to either <tt class="docutils literal"><span class="pre">True</span></tt> or
<tt class="docutils literal"><span class="pre">False</span></tt> depending on whether the communicator's rank is 0.</p>
<p>The test script shall output <tt class="docutils literal"><span class="pre">End</span> <span class="pre">Result:</span> <span class="pre">TEST</span> <span class="pre">PASSED</span></tt> if the test
passes correctly.  This helps the Trilinos test harness determine
which tests pass and which do not, especially in parallel.</p>
</div>
<div class="section">
<h1><a id="unit-tests" name="unit-tests">Unit Tests</a></h1>
<p>Unit tests are based on the <tt class="docutils literal"><span class="pre">unittest</span></tt> python library module.  Test
case classes inherit from <tt class="docutils literal"><span class="pre">unittest.TestCase</span></tt>.  Individual tests are
implemented as methods of these classes that begin with <tt class="docutils literal"><span class="pre">test</span></tt>.  See
the python documentation (<a class="reference" href="http://www.python.org">http://www.python.org</a>) for details.</p>
<p>Each unit test script can have one or more <tt class="docutils literal"><span class="pre">TestCase</span></tt> classes.  In
<tt class="docutils literal"><span class="pre">main()</span></tt>, each test case class should be added to a
<tt class="docutils literal"><span class="pre">unittest.TestSuite</span></tt> object named <tt class="docutils literal"><span class="pre">suite</span></tt>.</p>
<p>Unit tests shall print, from processor 0, a header with a message such
as &quot;Testing Epetra.Object&quot; with a line of asterisks above and below
the message:</p>
<pre class="literal-block">
*********************
Testing Epetra.Object
*********************
</pre>
<p>The suite of tests should be run with:</p>
<pre class="literal-block">
verbosity = options.verbosity * int(iAmRoot)
result = unittest.TextTestRunner(verbosity=verbosity).run(suite)
</pre>
<p>and the success should be determined and output via (for the case of
an Epetra communicator):</p>
<pre class="literal-block">
errsPlusFails = comm.SumAll(len(result.errors) + len(result.failures))
if errsPlusFails == 0 and iAmRoot: print &quot;End Result: TEST PASSED&quot;
sys.exit(errsPlusFails)
</pre>
<p>If there are no errors and no failures on any processors, then the
test will pass.</p>
</div>
<div class="section">
<h1><a id="example-scripts" name="example-scripts">Example Scripts</a></h1>
<p>Example scripts are more free-form and should be written for
readability, to make for clear demonstrations of PyTrilinos usage.
However, it is encouraged that example script output be consistent
with unit test output whenever possible.</p>
</div>
</div>
<div class="footer">
<hr class="footer" />
Generated on: 2010-07-27 17:56 UTC.
Generated by <a class="reference" href="http://docutils.sourceforge.net/">Docutils</a> from <a class="reference" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> source.

</div>
</body>
</html>
