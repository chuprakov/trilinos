<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.4: http://docutils.sourceforge.net/" />
<title>The PyTrilinos Build System</title>
<style type="text/css">

/*
:Author: David Goodger
:Contact: goodger@users.sourceforge.net
:Date: $Date: 2005-12-18 01:56:14 +0100 (Sun, 18 Dec 2005) $
:Revision: $Revision: 4224 $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin-left: 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em ;
  background-color: #eeeeee }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

tt.docutils {
  background-color: #eeeeee }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="the-pytrilinos-build-system">
<h1 class="title">The PyTrilinos Build System</h1>
<p>The move by Trilinos to the CMake build system has had many advantages
for PyTrilinos.  The two primary advantages being that shared
libraries and python extension libraries can now both be built
automatically by the host build system.  Previously, shared libraries
were built by the PyTrilinos package in an ad-hoc manner, and the
python extension libraries were built using the python distutils
module, which has some reports of portability issues.  The move to
CMake has improved the reliability and robustness of the PyTrilinos
build system.</p>
<p>From a build-system point of view, there are two types of Trilinos
packages that are supported by PyTrilinos: those that are contained
within a single namespace, like Teuchos, Epetra and AztecOO; and those
that are contained within nested namespaces, such as NOX.  These two
types are detailed below, in addition to the <tt class="docutils literal"><span class="pre">pytrilinos</span></tt> library
and package-specific configuration options.</p>
<div class="section">
<h1><a id="single-namespace-packages" name="single-namespace-packages">Single Namespace Packages</a></h1>
<p>All supported packages must be listed in the
<tt class="docutils literal"><span class="pre">LIB_OPTIONAL_DEP_PACKAGES</span></tt> variable in the
<tt class="docutils literal"><span class="pre">cmake/Dependencies.cmake</span></tt> file, and they should be listed in build
order.</p>
<p>The PyTrilinos build system maintains two variables,
<tt class="docutils literal"><span class="pre">PyTrilnos_PACKAGES</span></tt> and <tt class="docutils literal"><span class="pre">PyTrilinos_MODULES</span></tt>, both set in the
top-level <tt class="docutils literal"><span class="pre">CMakeLists.txt</span></tt> file, to keep track of what to build.
(Note that these variables are referenced as
<tt class="docutils literal"><span class="pre">${PACKAGE_NAME}_PACKAGES</span></tt> and <tt class="docutils literal"><span class="pre">${PACKAGE_NAME}_MODULES</span></tt> within
<tt class="docutils literal"><span class="pre">CMakeLists.txt</span></tt>.)  For single namespace packages, the entries in
these two variables is the same.  For example,</p>
<pre class="literal-block">
IF(PyTrilinos_ENABLE_Teuchos)
  APPEND_SET(${PACKAGE_NAME}_PACKAGES Teuchos)
  APPEND_SET(${PACKAGE_NAME}_MODULES  Teuchos)
ENDIF(PyTrilinos_ENABLE_Teuchos)
</pre>
<p>In this instance, the build system now expects to find a SWIG
interface file in the source directory <tt class="docutils literal"><span class="pre">src/Teuchos.i</span></tt> that defines
module <tt class="docutils literal"><span class="pre">PyTrilinos.Teuchos</span></tt>.  The end products will be placed in the
build directory <tt class="docutils literal"><span class="pre">src/PyTrilinos</span></tt>:</p>
<pre class="literal-block">
src/PyTrilinos/Teuchos.py
src/PyTrilinos/Teuchos.pyc
src/PyTrilinos/_Teuchos.so
</pre>
</div>
<div class="section">
<h1><a id="nested-namespace-packages" name="nested-namespace-packages">Nested Namespace Packages</a></h1>
<p>Using <tt class="docutils literal"><span class="pre">NOX</span></tt> as an example, the <tt class="docutils literal"><span class="pre">LIB_OPTIONAL_DEP_PACKAGES</span></tt>
variable in the <tt class="docutils literal"><span class="pre">cmake/Dependencies.cmake</span></tt> file should contain the
entry <tt class="docutils literal"><span class="pre">NOX</span></tt> and it should be listed in build order.</p>
<p>In the top-level <tt class="docutils literal"><span class="pre">CMakeLists.txt</span></tt> file, the variable
<tt class="docutils literal"><span class="pre">PyTrilinos_PACKAGES</span></tt> should be appended as before, with a single
entry.  But <tt class="docutils literal"><span class="pre">PyTrilinos_MODULES</span></tt> should contain an entry for each
nested namespace:</p>
<pre class="literal-block">
IF(PyTrilinos_ENABLE_NOX)
  APPEND_SET(${PACKAGE_NAME}_PACKAGES NOX)
  APPEND_SET(${PACKAGE_NAME}_MODULES  NOX.__init__  )
  APPEND_SET(${PACKAGE_NAME}_MODULES  NOX.Abstract  )
  APPEND_SET(${PACKAGE_NAME}_MODULES  NOX.StatusTest)
  APPEND_SET(${PACKAGE_NAME}_MODULES  NOX.Solver    )
  IF(NOX_ENABLE_Epetra)
    APPEND_SET(${PACKAGE_NAME}_MODULES NOX.Epetra.__init__ )
    APPEND_SET(${PACKAGE_NAME}_MODULES NOX.Epetra.Interface)
  ENDIF(NOX_ENABLE_Epetra)
ENDIF(PyTrilinos_ENABLE_NOX)
</pre>
<p>For every entry in <tt class="docutils literal"><span class="pre">PyTrilnos_MODULES</span></tt>, there should be a
corresponding SWIG file in the source directory:</p>
<pre class="literal-block">
src/NOX.__init__.i
src/NOX.Abstract.i
src/NOX.StatusTest.i
src/NOX.Solver.i
src/NOX.Epetra.__init__.i
src/NOX.Epetra.Interface.i
</pre>
<p>which will produce the following build products:</p>
<pre class="literal-block">
src/PyTrilinos/NOX/__init__.py
src/PyTrilinos/NOX/__init__.pyc
src/PyTrilinos/NOX/___init__.so
src/PyTrilinos/NOX/Abstract.py
src/PyTrilinos/NOX/Abstract.pyc
src/PyTrilinos/NOX/_Abstract.so
src/PyTrilinos/NOX/StatusTest.py
src/PyTrilinos/NOX/StatusTest.pyc
src/PyTrilinos/NOX/_StatusTest.so
src/PyTrilinos/NOX/Solver.py
src/PyTrilinos/NOX/Solver.pyc
src/PyTrilinos/NOX/_Solver.so
src/PyTrilinos/NOX/Epetra/__init__.py
src/PyTrilinos/NOX/Epetra/__init__.pyc
src/PyTrilinos/NOX/Epetra/___init__.so
src/PyTrilinos/NOX/Epetra/Interface.py
src/PyTrilinos/NOX/Epetra/Interface.pyc
src/PyTrilinos/NOX/Epetra/_Interface.so
</pre>
</div>
<div class="section">
<h1><a id="the-pytrilinos-library" name="the-pytrilinos-library">The <tt class="docutils literal"><span class="pre">pytrilinos</span></tt> Library</a></h1>
<p>If you develop a module that requires compiled code not generated by
SWIG, it should be put in the <tt class="docutils literal"><span class="pre">pytrilinos</span></tt> library.  Simply append
entries the the <tt class="docutils literal"><span class="pre">HEADERS</span></tt> and <tt class="docutils literal"><span class="pre">SOURCES</span></tt> variables in
<tt class="docutils literal"><span class="pre">src/CMakeLists.txt</span></tt> file.</p>
</div>
<div class="section">
<h1><a id="package-specific-configuration-options" name="package-specific-configuration-options">Package-Specific Configuration Options</a></h1>
<p>If you need package-specific configuration options set, they should be
done so in <tt class="docutils literal"><span class="pre">src/CMakeLists.txt</span></tt> prior tothe call the call to
<tt class="docutils literal"><span class="pre">PACKAGE_CONFIGURE_FILE()</span></tt>.  Currently, the following variable are
set depending upon the top-level Trilinos configuration:</p>
<pre class="literal-block">
HAVE_EPETRA
HAVE_TEUCHOS
HAVE_NOX_EPETRA
HAVE_NOX_EPETRAEXT
HAVE_MPI
</pre>
</div>
</div>
<div class="footer">
<hr class="footer" />
Generated on: 2009-12-20 17:49 UTC.
Generated by <a class="reference" href="http://docutils.sourceforge.net/">Docutils</a> from <a class="reference" href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> source.

</div>
</body>
</html>
