#ifndef INTREPID_F0_TET_C2_FEM_FIAT_HPP
#define INTREPID_F0_TET_C2_FEM_FIAT_HPP
#include "Intrepid_Basis.hpp"
#include "Intrepid_RealSpace.hpp"
#include "Intrepid_Utils.hpp"
#include "Intrepid_Tabulate.hpp"
#include "Intrepid_FieldContainer.hpp"
#include "Teuchos_Array.hpp"
#include "Teuchos_BLAS_types.hpp"

namespace Intrepid {

/** \class Intrepid::Basis_F0_TET_C2_FEM_FIAT
  \brief Implementation of FIAT FEM basis functions of degree 2 for 0-forms on TET cells. 
  Reconstruction space type is COMPLETE. Definition of the DoF set 
  for this basis, its enumeration and the associated local DoF tags are as follows,

\verbatim
  =================================================================================================
  |        |                degree-of-freedom-tag              |                                  |
  | DoF Id |---------------------------------------------------|          DoF definition          |
  |        |  subc dim  |  subc id   | subc DoFId |subc num DoF|                                  |
  |========|============|============|============|============|==================================|
  |    0   |     0      |     0      |     0      |     1      |           L_0(u)=u(0.0,0.0,0.0)  |
  |========|============|============|============|============|==================================|
  |    1   |     0      |     1      |     0      |     1      |           L_1(u)=u(1.0,0.0,0.0)  |
  |========|============|============|============|============|==================================|
  |    2   |     0      |     2      |     0      |     1      |           L_2(u)=u(0.0,1.0,0.0)  |
  |========|============|============|============|============|==================================|
  |    3   |     0      |     3      |     0      |     1      |           L_3(u)=u(0.0,0.0,1.0)  |
  |========|============|============|============|============|==================================|
  |    4   |     1      |     0      |     0      |     1      |           L_4(u)=u(0.5,0.0,0.0)  |
  |========|============|============|============|============|==================================|
  |    5   |     1      |     1      |     0      |     1      |           L_5(u)=u(0.5,0.5,0.0)  |
  |========|============|============|============|============|==================================|
  |    6   |     1      |     2      |     0      |     1      |           L_6(u)=u(0.0,0.5,0.0)  |
  |========|============|============|============|============|==================================|
  |    7   |     1      |     3      |     0      |     1      |           L_7(u)=u(0.0,0.0,0.5)  |
  |========|============|============|============|============|==================================|
  |    8   |     1      |     4      |     0      |     1      |           L_8(u)=u(0.5,0.0,0.5)  |
  |========|============|============|============|============|==================================|
  |    9   |     1      |     5      |     0      |     1      |           L_9(u)=u(0.0,0.5,0.5)  |
  |========|============|============|============|============|==================================|


\endverbatim

  The DefaultBasisFactory will select this basis
  if the following parameters are specified:
  \verbatim
  |=======================|===================================|
  |  EField               |  FIELD_FORM_0                     |
  |-----------------------|-----------------------------------|
  |  ECell                |  CELL_TET                   |
  |-----------------------|-----------------------------------|
  |  EReconstructionSpace |  RECONSTRUCTION_SPACE_COMPLETE    |
  |-----------------------|-----------------------------------|
  |  degree               |  2                          |
  |-----------------------|-----------------------------------|
  |  EBasis               |  BASIS_FEM_FIAT                   |
  |-----------------------|-----------------------------------|
  |  ECoordinates         |  COORDINATES_CARTESIAN            |
  |=======================|===================================|
  \endverbatim

*/

template<class Scalar>
class Basis_F0_TET_C2_FEM_FIAT: public Basis<Scalar> {
  private:
  
  /** \brief Dimension of the space spanned by the basis = number of degrees of freedom.
  */
  int numDof_;
  
  /**\brief Lookup table for the DoF's local enumeration (DoF Id) by its local DoF tag
  */
  Teuchos::Array<Teuchos::Array<Teuchos::Array<int> > > tagToEnum_;
  
  /**\brief Lookup table for the DoF's local DoF tag by its local enumeration (DoF Id)
  */
  Teuchos::Array<LocalDofTag> enumToTag_;
  
  /**\brief "true" if both lookup arrays have been set by initialize()
  */
  bool isSet_;

  /**\brief coefficients of nodal basis in terms of orthogonal polynomials */
  Teuchos::RCP<Teuchos::SerialDenseMatrix<int,Scalar> > vdm_;
  Teuchos::RCP<Teuchos::SerialDenseMatrix<int,Scalar> > dmats0_;
  Teuchos::RCP<Teuchos::SerialDenseMatrix<int,Scalar> > dmats1_;
  Teuchos::RCP<Teuchos::SerialDenseMatrix<int,Scalar> > dmats2_;

/* \brief Static data array that provides the Vandermonde and derivative matrices.  They need to
     be static data members because of the templating w.r.t type */
  #ifndef DOXYGEN_SHOULD_SKIP_THIS
  static Scalar *get_vdm_data() {
    static Scalar vdm_data[] = { -4.999999999999991e-02 , -4.999999999999993e-02 , -4.999999999999998e-02 , -4.999999999999999e-02 , 2.000000000000000e-01 , 2.000000000000000e-01 , 2.000000000000000e-01 , 2.000000000000001e-01 , 2.000000000000000e-01 , 2.000000000000000e-01 , -1.666666666666667e-01 , 1.666666666666667e-01 , 0.000000000000000e+00 , 0.000000000000000e+00 , -9.251858538542971e-18 , 3.333333333333334e-01 , -3.333333333333334e-01 , -3.333333333333333e-01 , 3.333333333333333e-01 , 0.000000000000000e+00 , -5.555555555555556e-02 , -5.555555555555556e-02 , 1.111111111111111e-01 , 0.000000000000000e+00 , -2.222222222222222e-01 , 1.111111111111111e-01 , 1.111111111111111e-01 , -1.111111111111111e-01 , -1.111111111111111e-01 , 2.222222222222222e-01 , -2.777777777777778e-02 , -2.777777777777777e-02 , -2.777777777777778e-02 , 8.333333333333334e-02 , -1.111111111111111e-01 , -1.111111111111111e-01 , -1.111111111111111e-01 , 1.111111111111111e-01 , 1.111111111111111e-01 , 1.111111111111111e-01 , 3.333333333333333e-01 , 3.333333333333333e-01 , 0.000000000000000e+00 , 0.000000000000000e+00 , -6.666666666666666e-01 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 2.000000000000000e-01 , -2.000000000000000e-01 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 4.000000000000000e-01 , -4.000000000000000e-01 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 1.333333333333333e-01 , -1.333333333333333e-01 , 0.000000000000000e+00 , 0.000000000000000e+00 , -9.251858538542971e-18 , -6.666666666666665e-02 , 6.666666666666668e-02 , -3.333333333333333e-01 , 3.333333333333333e-01 , 0.000000000000000e+00 , 6.666666666666668e-02 , 6.666666666666668e-02 , 2.000000000000000e-01 , 0.000000000000000e+00 , 6.666666666666667e-02 , -2.000000000000000e-01 , -2.000000000000000e-01 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 4.444444444444445e-02 , 4.444444444444443e-02 , -8.888888888888889e-02 , 0.000000000000000e+00 , 4.444444444444443e-02 , -2.222222222222223e-02 , -2.222222222222223e-02 , -1.111111111111111e-01 , -1.111111111111111e-01 , 2.222222222222222e-01 , 2.222222222222222e-02 , 2.222222222222222e-02 , 2.222222222222222e-02 , 1.333333333333333e-01 , 2.222222222222222e-02 , 2.222222222222222e-02 , 2.222222222222222e-02 , -8.888888888888889e-02 , -8.888888888888889e-02 , -8.888888888888889e-02 };
    return vdm_data;
  }

  static Scalar *get_dmats0_data() {
    static Scalar dmats0_data[] = { 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 5.656854249492381e+00 , -1.776356839400250e-15 , -8.881784197001252e-16 , -8.881784197001252e-16 , 0.000000000000000e+00 , -2.583561076591731e-15 , 0.000000000000000e+00 , 0.000000000000000e+00 , 1.077541110202794e-16 , -8.881784197001252e-16 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , -3.434996394210077e-15 , 1.697056274847714e+01 , 5.518433208703432e-16 , 7.200108702852338e-16 , -7.105427357601002e-15 , 8.881784197001251e-15 , 5.329070518200751e-15 , -6.055934969857329e-15 , -3.768221900841061e-15 , -2.085912009718399e-15 , 2.828427124746190e+00 , 8.367133432421036e-31 , 9.428090415820634e+00 , -9.428090415820636e-01 , 0.000000000000000e+00 , 3.983730122881619e-15 , -2.664535259100376e-15 , 3.552713678800501e-15 , 6.280369834735097e-16 , 0.000000000000000e+00 , 2.828427124746191e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 8.485281374238570e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 1.991865061440809e-15 , -1.776356839400250e-15 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 };
    return dmats0_data;
  }

  static Scalar *get_dmats1_data() {
    static Scalar dmats1_data[] = { 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 2.828427124746190e+00 , -8.881784197001251e-16 , -4.440892098500626e-16 , -4.440892098500626e-16 , 0.000000000000000e+00 , -1.291780538295865e-15 , 0.000000000000000e+00 , 0.000000000000000e+00 , 5.387705551013972e-17 , -4.440892098500626e-16 , 8.485281374238571e+00 , -3.552713678800500e-15 , 1.776356839400250e-15 , 0.000000000000000e+00 , 0.000000000000000e+00 , -3.226279360870944e-16 , -3.552713678800501e-15 , 0.000000000000000e+00 , 2.826166425630795e-15 , 1.776356839400250e-15 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 1.414213562373093e+00 , 8.485281374238570e+00 , -9.428090415820630e-01 , -4.714045207910313e-01 , -5.329070518200751e-15 , 4.306358058968712e-15 , 3.552713678800501e-15 , -3.108624468950438e-15 , -1.684382952588527e-15 , -1.110223024625157e-15 , 1.414213562373092e+00 , 1.414213562373095e+01 , 4.714045207910317e+00 , -4.714045207910316e-01 , -3.552713678800501e-15 , 1.442636293724256e-14 , 3.552713678800501e-15 , -5.329070518200751e-15 , -2.350516767363621e-15 , -1.332267629550188e-15 , 1.414213562373096e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 4.242640687119285e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 9.959325307204047e-16 , -8.881784197001252e-16 , -2.828427124746193e+00 , 3.552713678800502e-15 , 1.885618083164127e+01 , 9.428090415820634e-01 , 0.000000000000000e+00 , 1.108915748048262e-14 , 0.000000000000000e+00 , 3.552713678800501e-15 , -1.516215403173636e-15 , 2.664535259100376e-15 , 4.242640687119286e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 1.272792206135786e+01 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 2.099619172461089e-15 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 };
    return dmats1_data;
  }

  static Scalar *get_dmats2_data() {
    static Scalar dmats2_data[] = { 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 0.000000000000000e+00 , 2.828427124746190e+00 , -8.881784197001251e-16 , -4.440892098500626e-16 , -4.440892098500626e-16 , 0.000000000000000e+00 , -1.291780538295865e-15 , 0.000000000000000e+00 , 0.000000000000000e+00 , 5.387705551013972e-17 , -4.440892098500626e-16 , 2.828427124746190e+00 , -8.881784197001251e-16 , -8.881784197001252e-16 , -4.440892098500626e-16 , 0.000000000000000e+00 , -1.291780538295865e-15 , 0.000000000000000e+00 , -8.881784197001252e-16 , 5.387705551013972e-17 , -4.440892098500626e-16 , 1.131370849898476e+01 , -3.552713678800501e-15 , -1.776356839400250e-15 , -1.776356839400250e-15 , 0.000000000000000e+00 , -5.167122153183461e-15 , 0.000000000000000e+00 , 0.000000000000000e+00 , 2.155082220405589e-16 , -1.776356839400250e-15 , 1.414213562373093e+00 , 8.485281374238571e+00 , -9.428090415820628e-01 , -4.714045207910313e-01 , -7.105427357601002e-15 , 4.306358058968712e-15 , 3.552713678800501e-15 , -3.996802888650564e-15 , -2.572561372288652e-15 , -1.554312234475219e-15 , 1.414213562373094e+00 , 2.828427124746190e+00 , 4.714045207910318e+00 , -4.714045207910318e-01 , -1.332267629550188e-15 , 5.544578740241310e-15 , -1.332267629550188e-15 , 0.000000000000000e+00 , -5.741599279633705e-16 , 2.220446049250313e-16 , 1.414213562373092e+00 , 1.697056274847714e+01 , 1.077541110202802e-16 , 4.242640687119286e+00 , -7.105427357601002e-15 , 8.881784197001251e-15 , 3.552713678800501e-15 , -5.167756550157204e-15 , -2.556781148080097e-15 , -2.664535259100376e-15 , 1.414213562373094e+00 , 2.220446049250317e-16 , 7.542472332656508e+00 , -4.714045207910318e-01 , 0.000000000000000e+00 , 3.499153821777232e-15 , -1.543153930928705e-15 , 0.000000000000000e+00 , 1.202196911436880e-15 , 8.881784197001252e-16 , 1.414213562373094e+00 , 1.776356839400251e-15 , 1.697056274847714e+01 , 4.242640687119286e+00 , 0.000000000000000e+00 , 7.267375722618292e-15 , -2.994333975045686e-15 , 0.000000000000000e+00 , 1.884110950420530e-15 , 5.329070518200751e-15 , -7.071067811865475e+00 , 3.552713678800501e-15 , 0.000000000000000e+00 , 2.121320343559643e+01 , 0.000000000000000e+00 , 1.001161637027983e-14 , 4.131495527425913e-15 , 3.552713678800501e-15 , 4.710277376051325e-15 , 0.000000000000000e+00 };
    return dmats2_data;
  }
#endif


  public:

  /** \brief Constructor.
  */
  Basis_F0_TET_C2_FEM_FIAT() : numDof_(10), isSet_(false) , vdm_( rcp( new Teuchos::SerialDenseMatrix<int,Scalar>(Teuchos::View,Basis_F0_TET_C2_FEM_FIAT::get_vdm_data(),10,10,10) ) ),dmats0_( rcp( new Teuchos::SerialDenseMatrix<int,Scalar>(Teuchos::View,Basis_F0_TET_C2_FEM_FIAT::get_dmats0_data(),10,10,10) ) ),dmats1_( rcp( new Teuchos::SerialDenseMatrix<int,Scalar>(Teuchos::View,Basis_F0_TET_C2_FEM_FIAT::get_dmats1_data(),10,10,10) ) ),dmats2_( rcp( new Teuchos::SerialDenseMatrix<int,Scalar>(Teuchos::View,Basis_F0_TET_C2_FEM_FIAT::get_dmats2_data(),10,10,10) ) ) { }
  
  /** \brief Initializes arrays needed for the lookup of the local enumeration (DoF Id) of a 
    degree-of-freedom by its local DoF tag and the reverse lookup of the DoF tag by DoF Id.
   */
  void initialize();
  
  
  /** \brief Returns FieldContainer with multi-indexed quantity with the values of an operator 
  applied to a set of FEM basis functions, evaluated at a set of
  points in a <strong>reference</strong> cell. The rank of the return
  FieldContainer argument depends on the number of points, number of
  basis, functions, their rank, and the rank of the operator applied to them; see 
  FieldContainer::resize(int,int,EField,EOperator,int) for summary of
  the admissible index combinations.
  In particular, the admissible range of the <var>operatorType</var> argument depends on the rank of 
  the basis functions and the space dimension.Because FEM
  reconstruction relies on COMPLETE or INCOMPLETE polynomials, i.e.,
  smooth local spaces, the admissible range of <var>operatorType</var>
  always includes VALUE, D0, D1,...,D10. If derivative order exceeds
  polynomial degree, output container is filled with 0. 
 
      \param outputValues   [out]         - FieldContainer with the computed values (see
                                            implementation for index ordering)
      \param inputPoints     [in]         - evaluation points on the reference cell  
      \param operatorType    [in]         - the operator being applied to the basis function
  */    

  void getValues(FieldContainer<Scalar>&                  outputValues,
                 const Teuchos::Array< Point<Scalar> >& inputPoints,
                 const EOperator                        operatorType) const;
  
  
  /** \brief This method is intended for FVD reconstructions and should not be used here. Its 
    invocation will throw an exception. 
  */  
  void getValues(FieldContainer<Scalar>&                  outputValues,
                 const Teuchos::Array< Point<Scalar> >& inputPoints,
                 const Cell<Scalar>&                    cell) const;

  
  int getNumLocalDof() const;
  
  
  int getLocalDofEnumeration(const LocalDofTag dofTag);

  
  LocalDofTag getLocalDofTag(int id);

  
  const Teuchos::Array<LocalDofTag> & getAllLocalDofTags();

  
  ECell getCellType() const;

  
  EBasis getBasisType() const;

  
  ECoordinates getCoordinateSystem() const;

  
  int getDegree() const;

};

} // namespace Intrepid

#include "Intrepid_F0_TET_C2_FEM_FIATDef.hpp"

#endif

