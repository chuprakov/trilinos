INCLUDE(TribitsAddExecutableAndTest)
INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR})

IF( (${PACKAGE_NAME}_ENABLE_Tpetra                                      AND ${PACKAGE_NAME}_ENABLE_Ifpack2 AND ${PACKAGE_NAME}_ENABLE_Amesos2) OR
    (${PACKAGE_NAME}_ENABLE_Epetra AND ${PACKAGE_NAME}_ENABLE_EpetraExt AND ${PACKAGE_NAME}_ENABLE_Ifpack  AND ${PACKAGE_NAME}_ENABLE_Amesos))

    TRIBITS_ADD_EXECUTABLE(
      Q2Q1
      SOURCES Q2Q1.cpp MueLu_Q2Q1PFactory.hpp
      DEPLIBS muelu xpetra
      COMM serial mpi
      )

    TRIBITS_COPY_FILES_TO_BINARY_DIR(Q2Q1_cp
      SOURCE_FILES driver.xml
      Q2Q1_9x9_A.dat   Q2Q1_9x9_B.dat
      Q2Q1_17x17_A.dat Q2Q1_17x17_B.dat
      )

ENDIF()

#
# Tests
#

INCLUDE(XpetraAddTest)

IF (${PACKAGE_NAME}_ENABLE_Tpetra AND ${PACKAGE_NAME}_ENABLE_Ifpack2 AND ${PACKAGE_NAME}_ENABLE_Amesos2)
  XPETRA_ADD_TEST_TPETRA(Q2Q1 4)
ENDIF()
IF (${PACKAGE_NAME}_ENABLE_Epetra AND ${PACKAGE_NAME}_ENABLE_Ifpack  AND ${PACKAGE_NAME}_ENABLE_Amesos)
  XPETRA_ADD_TEST_EPETRA(Q2Q1 4)
ENDIF()
