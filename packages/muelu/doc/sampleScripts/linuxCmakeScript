#!/bin/sh
# cmake script for building ML with MPI on Linux 64 bit workstations with the Intel blas/lapack (aka mkl)
source /usr/local/intel/Compiler/11.1/064/mkl/tools/environment/mklvarsem64t.sh
export TRILINOS_HOME=${PWD}/../Trilinos

echo "PATH = ${PATH}"

WHICH_PACKAGE="MueLu"
BUILD_MODE="DEBUG"
#BUILD_MODE="RELEASE"
CXX_COMPILER_NAME=`mpicxx --version`
CXX_COMPILER_LOCATION=`which mpicxx`

EXTRA_ARGS=$@

echo ""
echo "Building Trilinos to support ${WHICH_PACKAGE}..."
echo ""
echo "Build mode = ${BUILD_MODE}"
echo ""
echo "c++ compiler : ${CXX_COMPILER_NAME}"
echo ""
echo "c++ compiler location: ${CXX_COMPILER_LOCATION}"
echo ""
sleep 3

# some useful cmake options
#  -D Trilinos_VERBOSE_CONFIGURE:BOOL=ON \
#  -D CMAKE_VERBOSE_MAKEFILE:BOOL=ON \
#  -D Trilinos_ENABLE_STRONG_C_COMPILE_WARNINGS:BOOL=OFF \
#  -D Trilinos_ENABLE_STRONG_CXX_COMPILE_WARNINGS:BOOL=OFF \
#  -D CMAKE_BUILD_TYPE:STRING=${BUILD_MODE} \
#  -D Trilinos_ENABLE_Tpetra:BOOL=ON \
#  -D CMAKE_BUILD_TYPE:STRING=NONE \
#  -D CMAKE_C_FLAGS:STRING="-O0 -g" \
#  -D CMAKE_CXX_FLAGS:STRING="-ansi -pedantic -Wall  -Wno-long-long -Wwrite-strings  -Wshadow -g -O0" \

cmake \
  -D CMAKE_INSTALL_PREFIX:PATH="${PWD}" \
  -D CMAKE_BUILD_TYPE:STRING=${BUILD_MODE} \
  -D Trilinos_ENABLE_SHADOW_WARNINGS:BOOL=ON \
  -D Trilinos_WARNINGS_AS_ERRORS_FLAGS:STRING="" \
\
  -D Trilinos_EXTRA_REPOSITORIES="MueLu" \
  -D Trilinos_ENABLE_MueLu:BOOL=ON \
\
  -D MueLu_ENABLE_ALL_OPTIONAL_PACKAGES:BOOL=ON \
\
  -D BLAS_LIBRARY_DIRS:STRING="/usr/local/intel/Compiler/11.1/064/mkl/lib/em64t;/usr/local/intel/Compiler/11.1/064/lib/intel64;/usr/lib64" \
  -D BLAS_LIBRARY_NAMES:STRING="mkl_intel_lp64; mkl_intel_thread; mkl_core; iomp5; pthread" \
  -D LAPACK_LIBRARY_DIRS:STRING="/usr/local/intel/Compiler/11.1/064/mkl/lib/em64t;/usr/local/intel/Compiler/11.1/064/lib/intel64;/usr/lib64" \
  -D LAPACK_LIBRARY_NAMES:STRING="mkl_intel_lp64; mkl_intel_thread; mkl_core; iomp5; pthread" \
\
  -D Trilinos_ENABLE_TESTS:BOOL=OFF \
  -D Trilinos_ENABLE_EXAMPLES:BOOL=OFF \
\
  -D MueLu_ENABLE_TESTS:BOOL=ON \
  -D MueLu_ENABLE_EXAMPLES:BOOL=ON \
\
  -D DART_TESTING_TIMEOUT:STRING=30 \
  -D TPL_ENABLE_MPI:BOOL=ON \
\
  $EXTRA_ARGS \
  ${TRILINOS_HOME}
