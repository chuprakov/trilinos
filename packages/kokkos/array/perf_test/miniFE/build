#!/bin/csh

#-----------------------------------------------------------------------------
# Quick and dirty build for miniFE application


set INC_PATH="-I../../../../ThreadPool/src -I. -I../../src"

set GCC_SOURCES="../../src/impl/*.cpp ../../src/DeviceHost/*.cpp main.cpp testHost.cpp"

set LIB=""

#-----------------------------------------------------------------------------
# Build for TPI

set GCC_SOURCES="${GCC_SOURCES} ../../../../ThreadPool/src/*.c ../../src/DeviceTPI/*.cpp testTPI.cpp"

set LIB="${LIB} -lpthread"

#set GCC_SOURCES="${GCC_SOURCES} testTPIStub.cpp"

#-----------------------------------------------------------------------------
# Build for Cuda

#/usr/local/cuda/bin/nvcc -arch=sm_20  ${INC_PATH} -O3 -lib -o libCuda.a \
#       ../../src/DeviceCuda/*.cu testCuda.cu

#set LIB="${LIB} -L/usr/local/cuda/lib64 libCuda.a -lcudart -lcuda -lcusparse"

set GCC_SOURCES="${GCC_SOURCES} testCudaStub.cpp"

#-----------------------------------------------------------------------------
#Build for TBB

#set GCC_SOURCES="${GCC_SOURCES} ../../src/DeviceTBB/*.cpp testTBB.cpp"

#set LIB="${LIB} -ltbb"

set GCC_SOURCES="${GCC_SOURCES} testTBBStub.cpp"

#-----------------------------------------------------------------------------

echo "#define HAVE_PTHREAD" > ThreadPool_config.h

set GCC_FLAGS="-Wall -O3 ${INC_PATH}"
# set GCC_FLAGS="-Wall -g ${INC_PATH}"

g++ $GCC_FLAGS -c ${GCC_SOURCES}

g++ $GCC_FLAGS -o mini_test.exe *.o ${LIB} 

rm -f *.o *.a ThreadPool_config.h

#-----------------------------------------------------------------------------

