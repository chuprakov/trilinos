# @HEADER@
# ************************************************************************
# 
#                              Sundance
#                 Copyright (2005) Sandia Corporation
# 
# Copyright (year first published) Sandia Corporation.  Under the terms 
# of Contract DE-AC04-94AL85000 with Sandia Corporation, the U.S. Government 
# retains certain rights in this software.
# 
# This library is free software; you can redistribute it and/or modify
# it under the terms of the GNU Lesser General Public License as
# published by the Free Software Foundation; either version 2.1 of the
# License, or (at your option) any later version.
#  
# This library is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#                                                                                 
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
# USA                                                                                
# Questions? Contact Kevin Long (krlong@sandia.gov), 
# Sandia National Laboratories, Livermore, California, USA
# 
# ************************************************************************
# @HEADER@

##########################################################################
#
# Macro definitions to be used internally before installation
# 
# -- KL 13 Dec 2005
#
##########################################################################


#-----------------------------------------------------------------------------------
# Import information on the locations of SUNDIALS, FIAT, and other 3rd party codes
#-----------------------------------------------------------------------------------

include $(SUNDANCE_BUILD_DIRECTORY)/Makefile.site.sundance


#-------------------------------------------------------------------------
# Set the absolute path to the Sundance and Trilinos build directories
#-------------------------------------------------------------------------

SUNDANCE_BUILD_DIRECTORY = @SUNDANCE_BUILD_DIRECTORY@

TRILINOS_DIR = @TRILINOS_DIR@

#-------------------------------------------------------------------------
# Import Trilinos makefile macros from the export files
#-------------------------------------------------------------------------

# Required dependence on Trilinos packages
include $(TRILINOS_DIR)/packages/epetra/Makefile.export.epetra
include $(TRILINOS_DIR)/packages/thyra/Makefile.export.thyra
include $(TRILINOS_DIR)/packages/teuchos/Makefile.export.teuchos
include $(TRILINOS_DIR)/packages/teuchos/Makefile.export.anasazi
include $(TRILINOS_DIR)/packages/aztecoo/Makefile.export.aztecoo
include $(TRILINOS_DIR)/packages/ifpack/Makefile.export.ifpack
include $(TRILINOS_DIR)/packages/nox/Makefile.export.nox
include $(TRILINOS_DIR)/packages/ml/Makefile.export.ml
include $(TRILINOS_DIR)/packages/amesos/Makefile.export.amesos
include $(TRILINOS_DIR)/packages/stratimikos/Makefile.export.stratimikos

TRILINOS_INCLUDES = -I$(TRILINOS_DIR)/include

TMP_TRILINOS_LIBS = @LDFLAGS@ \
  $(STRATIMIKOS_LIBS) \
  $(NOX_LIBS) \
  $(ML_LIBS) \
  $(AMESOS_LIBS) \
  $(AZTECOO_LIBS) \
  $(ANASAZI_LIBS) \
  $(IFPACK_LIBS) \  
  $(THYRA_LIBS) \
  $(EPETRAEXT_LIBS) \
  $(EPETRA_LIBS) \
  $(TEUCHOS_LIBS) 

TRILINOS_LIBS = $(shell $(PERL_EXE) @abs_top_srcdir@/config/strip_dup_libs.pl $(TMP_TRILINOS_LIBS))


#-------------------------------------------------------------------------
# Linker command flags
#-------------------------------------------------------------------------

SUNDANCE_LIBS = \
  $(STD_FWK_LIBS) $(STD_MESH_LIBS) $(CORE_LIBS) $(INTEROP_LIBS) $(UTIL_LIBS) $(SOLVERS_LIBS) 


#-------------------------------------------------------------------------
# Set macros for including and linking from the Sundance source subdirectories
#-------------------------------------------------------------------------

SUNDANCE_INCLUDES = $(SOLVERS_INCLUDES) $(UTIL_INCLUDES) $(INTEROP_INCLUDES) $(CORE_INCLUDES) \
  $(STD_MESH_INCLUDES) $(STD_FWK_INCLUDES) -I$(TRILINOS_DIR)/include

# --------- solvers
 
SOLVERS_INCLUDE_PATH =  \
-I@abs_top_builddir@/src-solvers \
-I@abs_top_srcdir@/src-solvers/Vectors \
-I@abs_top_srcdir@/src-solvers/Utils \
-I@abs_top_srcdir@/src-solvers/Concrete \
-I@abs_top_srcdir@/src-solvers/Operators \
-I@abs_top_srcdir@/src-solvers/LinearSolvers \
-I@abs_top_srcdir@/src-solvers/NonlinearSolvers \
-I@abs_top_srcdir@/src-solvers/Preconditioners \
-I@abs_top_srcdir@/src-solvers/Adapters \
-I@abs_top_srcdir@/src-solvers/Testing 

SOLVERS_INCLUDES = $(SOLVERS_INCLUDE_PATH) $(TRILINOS_INCLUDES) $(SUNDIALS_INCLUDES)

SOLVERS_LIBS = $(SOLVERS_LIB_PATH) -lTSFExtended $(TRILINOS_LIBS) $(SUNDIALS_LIBS)


# --------- utilities

UTIL_LIB_PATH = -L@abs_top_builddir@/src-utils $(SOLVERS_LIB_PATH) 

UTIL_LIBS = $(UTIL_LIB_PATH) -lsundanceUtils 



UTIL_INCLUDES =  \
-I@abs_top_builddir@/src-utils \
-I@abs_top_srcdir@/src-utils/Utilities 



# --------- interoperability stubs

INTEROP_LIB_PATH = -L@abs_top_builddir@/src-interop $(UTIL_LIB_PATH) 

INTEROP_LIBS = $(INTEROP_LIB_PATH) -lsundanceInterop 



INTEROP_INCLUDES =  \
-I@abs_top_builddir@/src-interop \
-I@abs_top_srcdir@/src-interop/Stubs 


# --------- symbolics

CORE_LIBS = $(CORE_LIB_PATH) -lsundanceCore 

CORE_LIB_PATH = \
-L@abs_top_builddir@/src-core 



CORE_INCLUDE_PATH =  \
-I@abs_top_builddir@/src-core \
-I@abs_top_srcdir@/src-core/UserExprs \
-I@abs_top_srcdir@/src-core/InternalExprs \
-I@abs_top_srcdir@/src-core/Evaluation \
-I@abs_top_srcdir@/src-core/FrameworkInterface \
-I@abs_top_srcdir@/src-core/Spectral \
-I@abs_top_srcdir@/src-core/SymbolicTransformations \
-I@abs_top_srcdir@/src-core/TestingUtilities 

CORE_INCLUDES = $(CORE_INCLUDE_PATH) 



# --------- mesh

STD_MESH_LIB_PATH = \
-L@abs_top_builddir@/src-std-mesh 

@EXODUS_STR@EXODUS_LIBS= -lexoIIv2c -lnetcdf

STD_MESH_LIBS = $(STD_MESH_LIB_PATH) -lsundanceStdMesh $(EXODUS_LIBS)

STD_MESH_INCLUDE_PATH =  \
-I@abs_top_builddir@/src-std-mesh \
-I@abs_top_srcdir@/src-std-mesh/CellFilter \
-I@abs_top_srcdir@/src-std-mesh/Concrete \
-I@abs_top_srcdir@/src-std-mesh/Interface \
-I@abs_top_srcdir@/src-std-mesh/Sources \
-I@abs_top_srcdir@/src-std-mesh/Transformations \
-I@abs_top_srcdir@/src-std-mesh/Writers 

STD_MESH_INCLUDES = $(STD_MESH_INCLUDE_PATH) 



# --------- framework

STD_FWK_LIB_PATH =  \
-L@abs_top_builddir@/src-std-framework \
$(FIAT_LIB_PATH) 

STD_FWK_INCLUDE_PATH = \
-I@abs_top_builddir@/src-std-framework \
-I@abs_top_srcdir@/src-std-framework/Elements \
-I@abs_top_srcdir@/src-std-framework/DOFMapping \
-I@abs_top_srcdir@/src-std-framework/Assembly \
-I@abs_top_srcdir@/src-std-framework/Problem \
$(FIAT_INCLUDE_PATH) 

STD_FWK_INCLUDES = $(STD_FWK_INCLUDE_PATH) $(FIAT_INCLUDE) $(FIAT_BLITZ_INCLUDE)

STD_FWK_LIBS = $(STD_FWK_LIB_PATH) -lsundanceStdFwk $(FIAT_LIBS) $(FIAT_BLITZ_LIBS) 

FIAT_BUILD_DIR = @FIAT_BUILD_DIR@

@FIAT_STR@FIAT_LIB_PATH=-L$(FIAT_BUILD_DIR)/lib
@FIAT_STR@FIAT_INCLUDE_PATH=-I$(FIAT_BUILD_DIR)/include

@FIAT_STR@FIAT_LIBS=-L$(FIAT_BUILD_DIR)/lib -lfiat -lblitz







# ------------------------------------------------------------------------
#
# include macros specified by Trilinos
#
# ------------------------------------------------------------------------


include $(SUNDANCE_BUILD_DIRECTORY)/Makefile.export.TSFExtended
include $(TRILINOS_DIR)/packages/teuchos/Makefile.export


RANLIB = @RANLIB@

CFLAGS = @CFLAGS@
CCFLAGS = @CCFLAGS@
FFLAGS = @FFLAGS@
CXXFLAGS = @CXXFLAGS@
LDFLAGS = @LDFLAGS@

MPI_LIBS = $(TEUCHOS_MPI_LIBS)
MPI_LIBDIR = $(TEUCHOS_MPI_LIBDIR)
MPI_INC = $(TEUCHOS_MPI_INC)
MPI_DIR = $(TEUCHOS_MPI_DIR)

FLIBS = $(TEUCHOS_FLIBS)
BLAS_LIBS = $(TEUCHOS_BLAS_LIBS)
LAPACK_LIBS = $(TEUCHOS_LAPACK_LIBS)

CXX = @CXX@

CC = @CC@

F77 = @F77@




