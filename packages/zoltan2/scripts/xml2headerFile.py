#!/usr/bin/python

# place a backslash before double quotes
esc = "\\"
quo = '"'
escquo = esc+quo

def addLine(line):
  global xmlParameterDef
  line = line.strip()
  if quo in line:
    parts = line.split(quo)
    line = escquo.join(parts)
  newline = "  \""+line+"\" \\\n"
  xmlParameterDef += newline

hppFile = open("Zoltan2_XML_Parameters.hpp", "w")

# The copyright

cFile = open("copyright.txt", "r")
heading = cFile.read()
hppFile.write(heading)
cFile.close()

# The comment

hppFile.write("// \n")
hppFile.write("// This file is automatically generated by a script\n")
hppFile.write("// at compile time that processes parameters.xml.\n")
hppFile.write("// \n")

hppFile.write("#ifndef ZOLTAN2_XML_PARAMETERS_HPP\n")
hppFile.write("#define ZOLTAN2_XML_PARAMETERS_HPP\n")

# The parameters

paramFile = open("../data/parameters.xml", "r")

xmlParameterDef = "\n#define XML_PARAMETER_STRING \\\n"

go = "no"
for line in paramFile:
  if "ParameterList" in line:
    addLine(line)
    go = "yes"
  elif "/ParameterList" in line:
    addLine(line)
    break
  elif go == "yes":
    if len(line) > 2:
      addLine(line)

paramFile.close()

# remove the last continuation character

xmlParameterDef = xmlParameterDef[0:-2] + "\n"

hppFile.write(xmlParameterDef)
hppFile.write("\n#endif   // ZOLTAN2_XML_PARAMETERS_HPP\n")
hppFile.close()
print "DONE"
