#!/bin/bash

# . /usr/local/modules/3.2.6/Modules/$MODULE_VERSION/bin/modulecmd tcsh	\
#	load sierra-devel-desktop-intel-10.1ip

rm -f ThreadPool_config.h
echo "#define HAVE_PTHREAD 1" > ThreadPool_config.h

TEST_SRC="test_main.c test_c_dnax.c test_c_tpi.c test_tpi_unit.c test_pthreads.c"

LIB_SRC="../src/TPI.c ../src/TPI_Walltime.c"

LIB_OBJ="TPI.o TPI_Walltime.o"

OPT="-O3"
# OPT="-g"

#-----------------------------------------------------------------------

icc	-std=c99 -strict-ansi -Wall -Wcheck -Werror -wd1418 -wd1419	\
	${OPT} -c	\
	-I. -I../src ${LIB_SRC}

icc	-std=c99 -strict-ansi -Wall -Wcheck -Werror -wd1418 -wd1419	\
	${OPT}	\
	-o test_tpi.intel.exe	\
	-I. -I../src ${TEST_SRC} ${LIB_OBJ} -lpthread

icc	-strict-ansi -Wall -Wcheck -Werror -wd1418 -wd1419	\
	${OPT}	\
	-o test_tpi_cpp.intel.exe	\
	-I. -I../src test_tpi.cpp ${LIB_OBJ} -lpthread -lstdc++

icc	-std=c99 -strict-ansi -Wall -Wcheck -Werror -wd1418 -wd1419	\
	${OPT}	\
	-o test_sum.intel.exe	\
	-I. -I../src test_mpi_sum.c ${LIB_OBJ} -lpthread

#-----------------------------------------------------------------------

mpicc	-std=c99 -strict-ansi -Wall -Wcheck -Werror -wd1418 -wd1419	\
	${OPT}	\
	-o test_sum.mpi.intel.exe	\
	-I../src -DTEST_WITH_MPI test_mpi_sum.c ${LIB_OBJ} -lpthread

#-----------------------------------------------------------------------

rm -f ThreadPool_config.h
echo "/* #define HAVE_PTHREAD 1 */" > ThreadPool_config.h

icc	-std=c99 -strict-ansi -Wall -Wcheck -Werror -wd1418 -wd1419	\
	${OPT} -c	\
	-I. -I../src ${LIB_SRC}

icc	-std=c99 -strict-ansi -Wall -Wcheck -Werror -wd1418 -wd1419	\
	${OPT}	\
	-o test_tpi.intel.noth.exe	\
	-I. -I../src ${TEST_SRC} ${LIB_OBJ} -lpthread

icc	-strict-ansi -Wall -Wcheck -Werror -wd1418 -wd1419	\
	${OPT}	\
	-o test_tpi_cpp.intel.noth.exe	\
	-I. -I../src test_tpi.cpp ${LIB_OBJ} -lpthread -lstdc++

icc	-std=c99 -strict-ansi -Wall -Wcheck -Werror -wd1418 -wd1419	\
	${OPT}	\
	-o test_sum.intel.noth.exe	\
	-I. -I../src test_mpi_sum.c ${LIB_OBJ} -lpthread

#-----------------------------------------------------------------------

mpicc	-std=c99 -strict-ansi -Wall -Wcheck -Werror -wd1418 -wd1419	\
	${OPT}	\
	-o test_sum.mpi.intel.noth.exe	\
	-I../src -DTEST_WITH_MPI test_mpi_sum.c ${LIB_OBJ} -lpthread

#-----------------------------------------------------------------------

