#!/bin/bash

source /usr/local/intel/cc/9.1.044/bin/iccvars.sh
source /usr/local/intel/fc/9.1.039/bin/ifortvars.sh

TEST_SRC="test_main.c test_c_dnax.c test_c_tpi.c test_pthreads.c"

LIB_SRC="../src/TPI_pthreads.c ../src/TPI_Walltime.c ../src/TPI_Concurrency.c"

LIB_OBJ="TPI_pthreads.o TPI_Walltime.o TPI_Concurrency.o"

OPT="-O3"
# OPT="-g"

#-----------------------------------------------------------------------

icc	-std=c99 -strict-ansi -Wall -Wcheck -Werror -wd1418 -wd1419	\
	${OPT} -c	\
	-I../include ${LIB_SRC} -lpthread

icc	-std=c99 -strict-ansi -Wall -Wcheck -Werror -wd1418 -wd1419	\
	${OPT}	\
	-o test_tpi.intel.exe	\
	-I../include ${TEST_SRC} ${LIB_OBJ} -lpthread

icc	-strict-ansi -Wall -Wcheck -Werror -wd1418 -wd1419	\
	${OPT}	\
	-o test_tpi_cpp.intel.exe	\
	-I../include test_tpi.cpp ${LIB_OBJ} -lpthread -lstdc++

icc	-std=c99 -strict-ansi -Wall -Wcheck -Werror -wd1418 -wd1419	\
	${OPT}	\
	-o test_sum.intel.exe	\
	-I../include test_mpi_sum.c ${LIB_OBJ} -lpthread

#-----------------------------------------------------------------------

MPICH_HOME="/usr/local/mpi/sierra/32Bit/1.2.7/intel-9.0"

export PATH="${MPICH_HOME}/bin:${PATH}"

mpicc	-std=c99 -strict-ansi -Wall -Wcheck -Werror -wd1418 -wd1419	\
	${OPT}	\
	-o test_sum.mpi.intel.exe	\
	-I../include -DTEST_WITH_MPI test_mpi_sum.c ${LIB_OBJ} -lpthread

#-----------------------------------------------------------------------

